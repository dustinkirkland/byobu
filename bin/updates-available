#!/bin/sh

print_updates() {
	u=$1
	if [ "$u" = "0" ]; then
		echo ""
	else
		echo "$u!"
	fi
	exit 0
}

cache=/var/run/updates-available
u=
# If global updates-available cache is present, use it.  Available as of jaunty.
if [ -r $cache ]; then
	u=`grep -m 1 "^[0-9]" $cache | sed "s/\s.*$//"`
	print_updates $u
fi

# If apt-check binary exists, use it
if [ -x /usr/lib/update-notifier/apt-check ]; then
	u=`/usr/lib/update-notifier/apt-check 2>&1 | tail -n 1 | sed "s/;.*$//"`
	print_updates $u
fi

# If apt-get exists, use it
if [ -x /usr/bin/apt-get ]; then
	u=`/usr/bin/apt-get -s -o Debug::NoLocking=true upgrade | grep -c ^Inst`
	print_updates $u
fi

# If yum exists, use it
if [ -x /usr/bin/yum ]; then
	u=`/usr/bin/yum list updates | grep -c "updates"`
	print_updates $u
fi

# If we're here, we have no idea
print_updates "?"
