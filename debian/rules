#!/usr/bin/make -f
# -*- makefile -*-

# Uncomment this to turn on verbose mode.
# export DH_VERBOSE=1

PACKAGE=screen-profiles
VER=`head -n 1 debian/changelog | sed 's/^.*(//' | sed 's/).*//' | sed 's/-.*//'`

get-orig-source:
	dh_testdir
	bzr branch . ${PACKAGE}-${VER}
	tar --exclude .bzr -zcvf ${PACKAGE}_${VER}.orig.tar.gz ${PACKAGE}-${VER}

install-po: update-pot
	for po in po/*.po ; do \
		lang=$${po#po/}; lang=$${lang%.po}; \
		mkdir -p po/locale/$${lang}/LC_MESSAGES/; \
		msgfmt $${po} -o po/locale/$${lang}/LC_MESSAGES/${PACKAGE}.mo ; \
	done

update-pot:
	rm -f po/${PACKAGE}.pot
	grep -v "^#" po/POTFILES.sh | while read po ; do \
		xgettext -o po/${PACKAGE}.pot -L Shell $${po} ; \
	done
	grep -v "^#" po/POTFILES.python | while read po ; do \
		xgettext -o po/${PACKAGE}.pot -L Python $${po} ; \
	done
	for po in po/*.po ; do \
		msgmerge $${po} po/${PACKAGE}.pot -o $${po} ; \
	done

prebuild:

build:
	# auto-generate the logo'd light/dark profiles
	./profiles/generate

clean:
	dh_clean
	./profiles/generate --clean
	for po in po/*.po ; do \
		lang=$${po#po/}; lang=$${lang%.po}; \
		rm -f po/locale/$${lang}/LC_MESSAGES/${PACKAGE}.mo ; \
	done

install: build install-po
	dh_testdir
	dh_testroot
	dh_clean -k
	dh_install -X.bzr

# Everything else is handled by dh_install

# Build architecture-independent files here.
binary-indep: build install
	dh_testdir -i
	dh_testroot -i
	dh_installdocs -X.bzr -i
	dh_installman -i screen-launcher.1 screen-profiles.1 select-screen-profile.1 motd+shell.1 screen-profiles-export.1
	dh_installchangelogs -i
	dh_installdebconf -i
	dh_compress -i
	dh_fixperms -i
	dh_link -i /usr/share/${PACKAGE}/profiles/ubuntu-light usr/share/${PACKAGE}/profiles/ubuntu
	dh_installdeb -i
	dh_gencontrol -i
	dh_md5sums -i
	dh_builddeb -i

binary: binary-indep
.PHONY: build clean binary-indep binary install prebuild get-orig-source

binary-arch:
