#!/usr/bin/make -f
# -*- makefile -*-

# Uncomment this to turn on verbose mode.
# export DH_VERBOSE=1

PKG=byobu
VER=`head -n 1 debian/changelog | sed 's/^.*(//' | sed 's/).*//' | sed 's/-.*//'`

install-po: update-pot
	for po in po/*.po ; do \
		lang=$${po#po/}; lang=$${lang%.po}; \
		mkdir -p debian/tmp/usr/share/locale/$${lang}/LC_MESSAGES/; \
		msgfmt $${po} -o debian/tmp/usr/share/locale/$${lang}/LC_MESSAGES/${PKG}.mo ; \
	done

update-pot:
	rm -f po/${PKG}.pot
	xgettext -f po/POTFILES.Shell -o po/${PKG}.pot -L Shell
	xgettext -f po/POTFILES.Python -o po/${PKG}.pot -L Python -j
	for po in po/*.po ; do \
		msgmerge $${po} po/${PKG}.pot -o $${po} ; \
	done

prebuild: clean
	dh_testdir
	cp debian/changelog ChangeLog
	aclocal
	automake --add-missing
	autoconf
	./configure --prefix=/usr

build: prebuild
	dh_testdir
	$(MAKE)

clean:
	dh_testdir
	dh_clean
	[ ! -f Makefile ] || $(MAKE) distclean
	rm -f ChangeLog
	for po in po/*.po ; do \
		lang=$${po#po/}; lang=$${lang%.po}; \
		rm -f po/locale/$${lang}/LC_MESSAGES/${PKG}.mo ; \
	done

install: build install-po
	dh_testdir
	dh_testroot
	$(MAKE) DESTDIR=$(CURDIR)/debian/tmp install
	dh_link usr/share/byobu/keybindings/f-keys usr/share/byobu/keybindings/common
	dh_link usr/bin/shell usr/bin/motd+shell

# Build architecture-independent files here.
binary-indep: build install
	dh_testdir -i
	dh_testroot -i
	dh_install -X.bzr --fail-missing --sourcedir=debian/tmp -i
	dh_installdocs -X.bzr -i
	dh_installman -i
	dh_installchangelogs -i
	dh_installdebconf -i
	dh_compress -i
	dh_fixperms -i
	dh_installdeb -i
	dh_gencontrol -i
	dh_md5sums -i
	dh_builddeb -i

binary: binary-indep
.PHONY: build clean binary-indep binary install prebuild

binary-arch:
